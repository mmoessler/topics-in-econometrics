
# Topic 02

```{r,include=FALSE}

library(knitr)
knitr::opts_chunk$set(
  include = TRUE,
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  eval = FALSE
  # fig.height = 8,
  # fig.width = 10,
  # fig.align = 'center'
  )
# options(scipen=1)
# options(width=9999)
# # See: https://stackoverflow.com/questions/36230790/missing-horizontal-scroll-bar-in-r-markdown-html-code-chunks-and-output

```

## Statistical Model

Statistical model for each observations $i$ (same $k$ regressors across $m$ equations),

\begin{align*}
\underset{\left(m \times 1\right)}{y_{i}} &= \underset{\left(m\times mk\right)}{\overline{X}_{i}} \underset{\left(mk \times 1\right)}{\beta} + \underset{\left(m \times 1\right)}{e_{i}}, \\

\begin{bmatrix} 
y_{1i} \\
y_{2i} \\
\vdots \\
y_{mi}
\end{bmatrix}
&=
\begin{bmatrix} 
x_{1i}^{'} & 0 & \cdots & 0 \\
0 & x_{2i}^{'} & \cdots & 0 \\
\vdots & \vdots & \ddots & 0 \\
0 & 0& \cdots & x_{mi}^{'}
\end{bmatrix}
+
\begin{bmatrix} 
\beta_{1} \\
\beta_{2} \\
\vdots \\
\beta_{m}
\end{bmatrix}
+
\begin{bmatrix} 
u_{1i} \\
u_{2i} \\
\vdots \\
u_{mi}
\end{bmatrix},
\end{align*}

with,

* $y_{ji}$ and $e_{ji}$ are scalars for $j=1,...,m$.
* $x_{ji}$ are $\left(k \times 1\right)$ matrix for $j=1,...,m$.
* $\beta$ are $\left(k \times 1\right)$ matrix for $j=1,...,m$.

With the same $k$ regressors across $m$ equations this simplifies to,

\begin{align*}
\underset{\left(m \times 1\right)}{y_{i}} &= \underset{\left(m\times mk\right)}{\left(\underset{\left(m \times m\right)}{I_{m}} \otimes \underset{\left(1\times k\right)}{x_{i}^{'}}\right)} \underset{\left(mk \times 1\right)}{\beta} + \underset{\left(m \times 1\right)}{e_{i}},
\end{align*}

thus,

\begin{align*}
\overline{X}_{i} =\underset{\left(m \times mk\right)}{\underset{\left(m \times m\right)}{I_{m}} \otimes \underset{\left(1 \times k\right)}{x_{i}^{'}}}
\end{align*}

Statistical model in matrix notation across observations $i$ (same $k$ regressors across $m$ equations),

\begin{align*}
\underset{\left(n \times m\right)}{Y} &= \underset{\left(n\times k\right)}{X} \underset{\left(k \times m\right)}{B} + \underset{\left(n \times k\right)}{E}.
\end{align*}

## Simulation

### Set up

```{r}

# clear workspace
rm (list = ls(all=TRUE))

# set seed
set.seed(1234567, kind="Mersenne-Twister")

```

### Data Generating Process

\begin{align*}
y_t B + x_t A &= u_t \\
u_t &= u_{t-1} P + v_t \\
v_t &= N\left(0, V_t\right) \\
V_t &= S_t S_t^{'} \\
S_t &= C + D w_t \\
x_{1t} &\sim U\left[x_{1l},x_{1u}\right] \\
x_{1t} &\sim N \left(\mu_{x_{1}},\sigma_{x_{1}}^2\right)
\end{align*}

### Simulation

```{r}

# number of observations
t <- 2000

# parameters
b1 <- 0.6 
b2 <- 0.2 

a1 <- 0.4
a2 <- -0.5 

c11 <- 1.0
c21 <- 0.5
c22 <- 2.0

d11  <- 0.5
d21  <- 0.2
d22  <- 0.2

p11 <- 0.8 
p12 <- 0.1
p21 <- -0.2 
p22 <- 0.6

b  <-  matrix(c(1, -b2,
                -b1, 1), nrow=2, byrow=T)
a  <- matrix(c(-a1, 0,
               0, -a2), nrow=2, byrow=T)
c  <-  matrix(c(c11,  0,
                c21, c22), nrow=2, byrow=T)
d  <-  matrix(c(d11,  0,
                d21,  d22), nrow=2, byrow=T)

# exogenous variables                      
x <- cbind(10*runif(t), 3*rnorm(t))
w <- runif(t)

# disturbances 
zeros <- array(0, c(t,2))
u <- zeros
v <- zeros
for (i in 2:t) {
  l      <- c + d * w[i]  
  v[i,]  <- rnorm(2) %*% t(l)
  u[i,1] <- p11*u[i-1,1] + p12*u[i-1,2] + v[i,1]
  u[i,2] <- p21*u[i-1,1] + p22*u[i-1,2] + v[i,2]  
}

# simulate the reduced form   
y <- zeros
for (i in seq(t)) {
  y[i,] <- -x[i,] %*% a %*% solve(b) + u[i,] %*% solve(b)    
}

```

### Plots

```{r}

par(mfrow=c(1,2))

ts.plot(y[,1])
ts.plot(y[,2])

```

### Reduced form parameters

```{r}

# parameteres of the reduced form
ab <- -a %*% solve(b)
ab

```

## Least-Squares Estimator

Use the model in matrix notation across observations $i$.

```{r}

# dimensions
m <- ncol(y);m
t <- nrow(y);t
k <- ncol(x);k

# stack regressands and regressors
Y <- as.vector(y) # stack y over observations
length(Y)

X <- diag(m) %x% x # stack x over observations
dim(X)

```

```{r}

# estimation
lm.res <- lm(Y ~ X - 1)
lm.res$coefficients

# comoare with reduced form parameters for simmulation
as.vector(ab)

```

```{r}

# expand residuals again
u <- matrix(lm.res$residuals, ncol = m)
dim(u)

Sig.u <- 1/t * t(u) %*% u
Sig.u

# comoare with reduced form parameters for simmulation
# ???

```

## Sample Distribution of Least-Squares Estimator

General form:

\begin{align*}
V_{\beta} = Q^{-1} \Omega Q^{-1}
\end{align*}

$\Omega$ in the population (robust w.r.t heteroskedasticity):

<div hidden>

\begin{align*}
\underset{\left(mk\times m\right)}{\overline{X}_{i}^{'}}\underset{\left(m\times 1\right)}{e_{i}} = \left(\begin{array}{c}
\underset{\left(k\times 1\right)}{x_{1i}}\underset{\left(k\times 1\right)}{e_{1i}} \\ \vdots \\ \underset{\left(k\times 1\right)}{x_{mi}}\underset{\left(1\times 1\right)}{e_{mi}} \end{array}\right)
\end{align*}

\begin{align*}
\frac{1}{\sqrt{n}}\sum_{i=1}^{n}\underset{\left(mk\times m\right)}{\overline{X}_{i}^{'}}\underset{\left(m\times 1\right)}{e_{i}} \underset{d}{\rightarrow}N\left(\underset{\left(mk\times 1\right)}{0}\underset{\left(mk\times mk\right)}{\Omega}\right)
\end{align*}

</div>

\begin{align*}
\underset{\left(mk\times mk\right)}{\Omega} &= \text{E}\left[\underset{\left(mk\times m\right)}{\overline{X}_{i}^{'}}\underset{\left(m\times 1\right)}{e_{i}^{\phantom{'}}}\underset{\left(1\times m\right)}{e_{i}^{'}}\underset{\left(m\times km\right)}{\overline{X}_{i}^{\phantom{'}}}\right] \\
\phantom{\underset{\left(mk\times mk\right)}{\Omega}} &= \text{E} \left[ \underset{\left(mk \times m\right)}{\left(  \underset{\left(m \times m\right)}{I_{m}^{\phantom{'}}} \otimes \underset{\left(k \times 1\right)}{x_{i}^{\phantom{'}}} \right)} \underset{\left(m \times 1\right)}{e_{i}^{\phantom{'}}} \underset{\left(1 \times m\right)}{e_{i}^{'}} \underset{\left(m \times mk\right)}{\left( \underset{\left(m \times m\right)}{I_{m}^{\phantom{'}}} \otimes \underset{\left(1 \times k\right)}{x_{i}^{'}} \right)} \right] \\
\phantom{\underset{\left(mk\times mk\right)}{\Omega}} &= \text{E}\left[\underset{\left(m \times 1\right)}{e_{i}^{\phantom{'}}}\underset{\left(1 \times m\right)}{e_{i}^{'}} \otimes \underset{\left(k \times 1\right)}{x_{i}^{\phantom{'}}}\underset{\left(1 \times k\right)}{x_{i}^{'}}\right]
\end{align*}

$\Omega$ in the population (robust w.r.t heteroskedasticity and serial correlation):

\begin{align*}
\underset{\left(mk\times mk\right)}{\Omega} &= \sum_{l=-\infty}^{\infty} \text{E}\left[\underset{\left(mk\times m\right)}{\overline{X}_{t-l}^{'}}\underset{\left(m\times 1\right)}{e_{t-l}^{\phantom{'}}}\underset{\left(1\times m\right)}{e_{t}^{'}}\underset{\left(m\times km\right)}{\overline{X}_{t}^{\phantom{'}}}\right]  \\
\phantom{\underset{\left(mk\times mk\right)}{\Omega}} &= \sum_{l=-\infty}^{\infty} \text{E} \left[ \underset{\left(mk \times m\right)}{\left(  \underset{\left(m \times m\right)}{I_{m}^{\phantom{'}}} \otimes \underset{\left(k \times 1\right)}{x_{t-l}^{\phantom{'}}} \right)} \underset{\left(m \times 1\right)}{e_{t-l}^{\phantom{'}}} \underset{\left(1 \times m\right)}{e_{t}^{'}} \underset{\left(m \times mk\right)}{\left( \underset{\left(m \times m\right)}{I_{m}^{\phantom{'}}} \otimes \underset{\left(1 \times k\right)}{x_{t}^{'}} \right)} \right] \\
\phantom{\underset{\left(mk\times mk\right)}{\Omega}} &= \sum_{l=-\infty}^{\infty} \text{E}\left[\underset{\left(m \times 1\right)}{e_{t-l}^{\phantom{'}}}\underset{\left(1 \times m\right)}{e_{t}^{'}} \otimes \underset{\left(k \times 1\right)}{x_{t-l}^{\phantom{'}}}\underset{\left(1 \times k\right)}{x_{t}^{'}}\right]
\end{align*}

$Q$ in the population:

\begin{align*}
\underset{\left(mk\times mk\right)}{Q} &= \text{E} \left[ \overline{X}_{i}^{'} \overline{X}_{i} \right] \\
\phantom{Q} &= \text{E} \left[ \left( I_{m} \otimes x_{i} \right) \left( I_{m} \otimes x_{i}^{'} \right) \right] \\
\phantom{Q} &= I_{m} \otimes \text{E} \left[ x_{i}^{'} x_{i} \right]
\end{align*}

Sample counterpart of $\Omega$ (robust w.r.t heteroskedasticity):

\begin{align*}
\underset{\left(mk\times mk\right)}{\widehat{\Omega}} &= \sum_{i=1}^{n} \underset{\left(mk\times m\right)}{\overline{X}_{i}^{'}}\underset{\left(m\times 1\right)}{\widehat{e}_{i}}\underset{\left(1\times m\right)}{\widehat{e}_{i}^{'}}\underset{\left(m\times km\right)}{\overline{X}_{i}} \\
\phantom{\underset{\left(mk\times mk\right)}{\widehat{\Omega}}} &= \sum_{i=1}^{n} \left( \left( I_{m} \otimes x_{i} \right) \widehat{e}_{i} \widehat{e}_{i}^{'} \left( I_{m} \otimes x_{i}^{'} \right) \right) \\
\phantom{\underset{\left(mk\times mk\right)}{\widehat{\Omega}}} &= \sum_{i=1}^{n}\left(\widehat{e}_{i}\widehat{e}_{i}^{'} \otimes x_{i}x_{i}^{'}\right)
\end{align*}

Sample counterpart of $\Omega$ (robust w.r.t heteroskedasticity and serial correlation):

...

Sample counterpart of $Q$:

\begin{align*}
\underset{\left(mk\times mk\right)}{Q} &= \sum_{i=1}^{n} \left( \overline{X}_{i}^{'} \overline{X}_{i} \right) \\
\phantom{Q} &= \sum_{i=1}^{n} \left( \left( I_{m} \otimes x_{i} \right) \left( I_{m} \otimes x_{i}^{'} \right) \right) \\
\phantom{Q} &= I_{m} \otimes \sum_{i=1}^{n} \left( x_{i}^{'} x_{i} \right)
\end{align*}

Sample counterpart of $V_{\beta}$:

\begin{align*}
\widehat{V}_{\widehat{\beta}} &= \widehat{Q}^{-1} \widehat{\Omega} \widehat{Q}^{-1} \\
\phantom{\widehat{V}_{\widehat{\beta}}} &= \left(I_{m} \otimes \sum_{i=1}^{n} \left( x_{i}^{'} x_{i} \right)\right)^{-1} \sum_{i=1}^{n}\left(\widehat{e}_{i}\widehat{e}_{i}^{'} \otimes x_{i}x_{i}^{'}\right) \left(I_{m} \otimes \sum_{i=1}^{n} \left( x_{i}^{'} x_{i} \right)\right)^{-1} \\
\phantom{\widehat{V}_{\widehat{\beta}}} &= \left(I_{m} \otimes \left( X^{'} X \right)^{-1}\right) \sum_{i=1}^{n}\left(\widehat{e}_{i}\widehat{e}_{i}^{'} \otimes x_{i}x_{i}^{'}\right) \left(I_{m} \otimes \left( X^{'} X \right)^{-1}\right)
\end{align*}
